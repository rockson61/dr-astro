import { e as createAstro, c as createComponent, r as renderComponent, a as renderTemplate, b as addAttribute, m as maybeRenderHead } from '../../chunks/astro/server_DcquF9um.mjs';
import 'piccolore';
import { $ as $$DashboardLayout } from '../../chunks/DashboardLayout_DL6NAmdh.mjs';
import { c as createSupabaseServerClient } from '../../chunks/supabase_CFYPoMlB.mjs';
import { Download, CheckCircle, Award } from 'lucide-react';
import { format } from 'date-fns';
export { renderers } from '../../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro("https://dentalreach.today");
const prerender = false;
const $$MyCe = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$MyCe;
  const supabase = createSupabaseServerClient(Astro2);
  const {
    data: { user }
  } = await supabase.auth.getUser();
  if (!user) {
    return Astro2.redirect("/login");
  }
  const { data: credits, error } = await supabase.from("user_ce_credits").select("*, quiz:quizzes(title, ce_credits)").eq("user_id", user.id).order("completed_at", { ascending: false });
  const totalCredits = credits?.reduce(
    (acc, curr) => curr.passed ? acc + curr.credits_earned : acc,
    0
  ) || 0;
  return renderTemplate`${renderComponent($$result, "DashboardLayout", $$DashboardLayout, { "title": "My CE Credits" }, { "default": async ($$result2) => renderTemplate(_a || (_a = __template([" ", '<div class="grid md:grid-cols-3 gap-6 mb-8"> <div class="bg-gradient-to-br from-tuio-navy to-blue-900 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden"> <div class="absolute top-0 right-0 p-4 opacity-10"> ', ' </div> <div class="relative z-10"> <p class="text-xs font-bold uppercase tracking-widest opacity-70 mb-1">\nTotal Credits Earned\n</p> <h2 class="text-5xl font-tuio">', '</h2> <div class="mt-4 flex items-center gap-2 text-sm bg-white/10 px-3 py-1 rounded-full w-fit"> ', ' <span>Valid for Generic Requirement</span> </div> </div> </div> <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center"> <h3 class="font-bold text-gray-400 uppercase text-xs tracking-widest mb-2">\nQuizzes Attempted\n</h3> <div class="text-3xl font-tuio text-tuio-navy"> ', ' </div> </div> <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center"> <h3 class="font-bold text-gray-400 uppercase text-xs tracking-widest mb-2">\nCompletion Rate\n</h3> <div class="text-3xl font-tuio text-tuio-navy"> ', '%\n</div> </div> </div> <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"> <div class="p-6 border-b border-gray-100 flex justify-between items-center"> <h3 class="font-tuio uppercase text-lg text-tuio-navy">\nActivity Log\n</h3> </div> <div class="overflow-x-auto"> <table class="w-full"> <thead class="bg-gray-50 text-xs font-bold text-gray-400 uppercase tracking-widest text-left"> <tr> <th class="p-6">Activity / Quiz</th> <th class="p-6">Date</th> <th class="p-6">Score</th> <th class="p-6">Credits</th> <th class="p-6 text-right">Certificate</th> </tr> </thead> <tbody class="divide-y divide-gray-100"> ', " ", ' </tbody> </table> </div> </div> <div id="certificate-template" class="hidden fixed inset-0 z-[9999] bg-white p-20 flex items-center justify-center"> <div class="w-[800px] h-[600px] border-[20px] border-tuio-navy p-10 relative bg-white text-center flex flex-col items-center justify-center"> <div class="absolute top-0 left-0 w-32 h-32 bg-tuio-red/20 rounded-br-[100px]"></div> <div class="absolute bottom-0 right-0 w-32 h-32 bg-tuio-red/20 rounded-tl-[100px]"></div> <img src="/logo.png" class="h-16 mb-8">  <h1 class="text-5xl font-tuio uppercase text-tuio-navy mb-4">\nCertificate of Completion\n</h1> <p class="text-gray-500 uppercase tracking-widest text-sm mb-12">\nThis certifies that\n</p> <h2 class="text-4xl font-bold text-tuio-red mb-8 border-b-2 border-gray-200 pb-4 px-12 min-w-[400px]"> ', '  </h2> <p class="text-gray-600 mb-2">\nHas successfully completed the educational activity:\n</p> <h3 class="text-2xl font-bold text-tuio-navy mb-8" id="cert-quiz-title">\n[Quiz Title]\n</h3> <div class="flex justify-between w-full max-w-lg mt-8 text-left"> <div> <p class="text-xs text-gray-400 uppercase tracking-widest">\nDate\n</p> <p class="font-bold text-tuio-navy" id="cert-date">\n[Date]\n</p> </div> <div> <p class="text-xs text-gray-400 uppercase tracking-widest">\nCertificate ID\n</p> <p class="font-bold text-tuio-navy" id="cert-id">[ID]</p> </div> <div> <p class="text-xs text-gray-400 uppercase tracking-widest">\nProvider\n</p> <p class="font-bold text-tuio-navy">DentalReach</p> </div> </div> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script> <script>\n        function downloadCertificate(id, title, date) {\n            const element = document.getElementById("certificate-template");\n            const quizTitleEl = document.getElementById("cert-quiz-title");\n            const dateEl = document.getElementById("cert-date");\n            const idEl = document.getElementById("cert-id");\n\n            if (element && quizTitleEl && dateEl && idEl) {\n                quizTitleEl.innerText = title;\n                dateEl.innerText = date;\n                idEl.innerText = id;\n\n                element.classList.remove("hidden"); // Show for PDF generation\n\n                html2pdf(element, {\n                    margin: 0,\n                    filename: `Certificate-${id}.pdf`,\n                    image: { type: "jpeg", quality: 0.98 },\n                    html2canvas: { scale: 2 },\n                    jsPDF: {\n                        unit: "in",\n                        format: "letter",\n                        orientation: "landscape",\n                    },\n                }).then(() => {\n                    element.classList.add("hidden"); // Hide again\n                });\n            }\n        }\n    <\/script> '], [" ", '<div class="grid md:grid-cols-3 gap-6 mb-8"> <div class="bg-gradient-to-br from-tuio-navy to-blue-900 rounded-2xl p-6 text-white shadow-xl relative overflow-hidden"> <div class="absolute top-0 right-0 p-4 opacity-10"> ', ' </div> <div class="relative z-10"> <p class="text-xs font-bold uppercase tracking-widest opacity-70 mb-1">\nTotal Credits Earned\n</p> <h2 class="text-5xl font-tuio">', '</h2> <div class="mt-4 flex items-center gap-2 text-sm bg-white/10 px-3 py-1 rounded-full w-fit"> ', ' <span>Valid for Generic Requirement</span> </div> </div> </div> <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center"> <h3 class="font-bold text-gray-400 uppercase text-xs tracking-widest mb-2">\nQuizzes Attempted\n</h3> <div class="text-3xl font-tuio text-tuio-navy"> ', ' </div> </div> <div class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 flex flex-col justify-center"> <h3 class="font-bold text-gray-400 uppercase text-xs tracking-widest mb-2">\nCompletion Rate\n</h3> <div class="text-3xl font-tuio text-tuio-navy"> ', '%\n</div> </div> </div> <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden"> <div class="p-6 border-b border-gray-100 flex justify-between items-center"> <h3 class="font-tuio uppercase text-lg text-tuio-navy">\nActivity Log\n</h3> </div> <div class="overflow-x-auto"> <table class="w-full"> <thead class="bg-gray-50 text-xs font-bold text-gray-400 uppercase tracking-widest text-left"> <tr> <th class="p-6">Activity / Quiz</th> <th class="p-6">Date</th> <th class="p-6">Score</th> <th class="p-6">Credits</th> <th class="p-6 text-right">Certificate</th> </tr> </thead> <tbody class="divide-y divide-gray-100"> ', " ", ' </tbody> </table> </div> </div> <div id="certificate-template" class="hidden fixed inset-0 z-[9999] bg-white p-20 flex items-center justify-center"> <div class="w-[800px] h-[600px] border-[20px] border-tuio-navy p-10 relative bg-white text-center flex flex-col items-center justify-center"> <div class="absolute top-0 left-0 w-32 h-32 bg-tuio-red/20 rounded-br-[100px]"></div> <div class="absolute bottom-0 right-0 w-32 h-32 bg-tuio-red/20 rounded-tl-[100px]"></div> <img src="/logo.png" class="h-16 mb-8">  <h1 class="text-5xl font-tuio uppercase text-tuio-navy mb-4">\nCertificate of Completion\n</h1> <p class="text-gray-500 uppercase tracking-widest text-sm mb-12">\nThis certifies that\n</p> <h2 class="text-4xl font-bold text-tuio-red mb-8 border-b-2 border-gray-200 pb-4 px-12 min-w-[400px]"> ', '  </h2> <p class="text-gray-600 mb-2">\nHas successfully completed the educational activity:\n</p> <h3 class="text-2xl font-bold text-tuio-navy mb-8" id="cert-quiz-title">\n[Quiz Title]\n</h3> <div class="flex justify-between w-full max-w-lg mt-8 text-left"> <div> <p class="text-xs text-gray-400 uppercase tracking-widest">\nDate\n</p> <p class="font-bold text-tuio-navy" id="cert-date">\n[Date]\n</p> </div> <div> <p class="text-xs text-gray-400 uppercase tracking-widest">\nCertificate ID\n</p> <p class="font-bold text-tuio-navy" id="cert-id">[ID]</p> </div> <div> <p class="text-xs text-gray-400 uppercase tracking-widest">\nProvider\n</p> <p class="font-bold text-tuio-navy">DentalReach</p> </div> </div> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"><\/script> <script>\n        function downloadCertificate(id, title, date) {\n            const element = document.getElementById("certificate-template");\n            const quizTitleEl = document.getElementById("cert-quiz-title");\n            const dateEl = document.getElementById("cert-date");\n            const idEl = document.getElementById("cert-id");\n\n            if (element && quizTitleEl && dateEl && idEl) {\n                quizTitleEl.innerText = title;\n                dateEl.innerText = date;\n                idEl.innerText = id;\n\n                element.classList.remove("hidden"); // Show for PDF generation\n\n                html2pdf(element, {\n                    margin: 0,\n                    filename: \\`Certificate-\\${id}.pdf\\`,\n                    image: { type: "jpeg", quality: 0.98 },\n                    html2canvas: { scale: 2 },\n                    jsPDF: {\n                        unit: "in",\n                        format: "letter",\n                        orientation: "landscape",\n                    },\n                }).then(() => {\n                    element.classList.add("hidden"); // Hide again\n                });\n            }\n        }\n    <\/script> '])), maybeRenderHead(), renderComponent($$result2, "Award", Award, { "size": 100 }), totalCredits.toFixed(1), renderComponent($$result2, "CheckCircle", CheckCircle, { "size": 14, "className": "text-green-400" }), credits?.length || 0, credits?.length ? Math.round(
    credits.filter((c) => c.passed).length / credits.length * 100
  ) : 0, credits?.map((credit) => renderTemplate`<tr class="hover:bg-gray-50 transition-colors"> <td class="p-6 font-medium text-tuio-navy"> ${credit.quiz?.title || "Unknown Quiz"} ${!credit.passed && renderTemplate`<span class="ml-2 text-xs bg-red-100 text-red-600 px-2 py-0.5 rounded font-bold">
Failed
</span>`} </td> <td class="p-6 text-gray-500 text-sm"> ${format(
    new Date(credit.completed_at),
    "MMM d, yyyy"
  )} </td> <td class="p-6 font-bold"> <span${addAttribute(
    credit.passed ? "text-green-600" : "text-red-500",
    "class"
  )}> ${credit.score}%
</span> </td> <td class="p-6 font-bold text-tuio-navy"> ${credit.passed ? credit.credits_earned : 0} </td> <td class="p-6 text-right"> ${credit.passed && renderTemplate`<button${addAttribute(`downloadCertificate('${credit.certificate_id}', '${credit.quiz?.title}', '${format(new Date(credit.completed_at), "MMM d, yyyy")}')`, "onclick")} class="text-tuio-red hover:text-tuio-navy font-bold text-xs uppercase tracking-wide flex items-center gap-2 ml-auto"> ${renderComponent($$result2, "Download", Download, { "size": 16 })} Download
</button>`} </td> </tr>`), (!credits || credits.length === 0) && renderTemplate`<tr> <td colspan="5" class="p-12 text-center text-gray-400">
No CE activity found. Take quizzes on
                                    articles to earn credits.
</td> </tr>`, user.email) })}`;
}, "/Users/rockson61/Downloads/DR Astro/src/pages/dashboard/my-ce.astro", void 0);

const $$file = "/Users/rockson61/Downloads/DR Astro/src/pages/dashboard/my-ce.astro";
const $$url = "/dashboard/my-ce";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
    __proto__: null,
    default: $$MyCe,
    file: $$file,
    prerender,
    url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
