import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.JXKNaeUN.js";import{c as F}from"./supabase.svVmE_Zl.js";import{G as w}from"./GlassCard.Cfd5MXeQ.js";import{G as D}from"./GlassContainer.OVLJuRR9.js";import{P as G}from"./plus.x7Bu--mN.js";import{T as j}from"./trophy.B9iE41hh.js";import{S as I}from"./search.BNTBrPA9.js";import{U as M}from"./users.CLfLw16X.js";import"./createLucideIcon.BhldaWgv.js";const l=F();function K(){const[u,p]=r.useState([]),[a,N]=r.useState(null),[o,c]=r.useState([]),[$,v]=r.useState(!0),[S,d]=r.useState(!1),[i,m]=r.useState({title:"",year:new Date().getFullYear(),description:""}),[_,h]=r.useState(""),[g,x]=r.useState([]),[L,f]=r.useState(!1);r.useEffect(()=>{C()},[]),r.useEffect(()=>{a&&b(a.id)},[a]);const C=async()=>{try{const{data:t,error:s}=await l.from("awards").select("*").order("year",{ascending:!1});if(s)throw s;p(t||[])}catch(t){console.error("Error fetching awards:",t)}finally{v(!1)}},b=async t=>{try{const{data:s,error:n}=await l.from("award_nominations").select("*, nominee_profile:profiles!nominee_id(full_name, email)").eq("award_id",t);n?(console.warn("Error fetching nominations (table might be missing):",n),c([])):c(s||[])}catch(s){console.error("Execption fetching nominations:",s)}},A=async t=>{t.preventDefault();try{const s=i.title.toLowerCase().replace(/[^a-z0-9]+/g,"-")+"-"+i.year,{data:n,error:y}=await l.from("awards").insert({title:i.title,year:i.year,slug:s,description:i.description,status:"nominations_open"}).select().single();if(y)throw y;p([n,...u]),d(!1),m({title:"",year:new Date().getFullYear(),description:""})}catch(s){alert("Failed to create award"),console.error(s)}},k=async t=>{if(h(t),t.length<2){x([]);return}f(!0);const{data:s}=await l.from("profiles").select("id, full_name, email").ilike("full_name",`%${t}%`).limit(5);x(s||[]),f(!1)},U=async t=>{if(a)try{const{error:s}=await l.from("award_nominations").insert({award_id:a.id,nominee_id:t.id,status:"nominated"});if(s)throw s;b(a.id),h(""),x([])}catch(s){alert("Failed to nominate user (maybe already nominated?)"),console.error(s)}},E=async(t,s)=>{try{await l.from("award_nominations").update({status:s}).eq("id",t),c(o.map(n=>n.id===t?{...n,status:s}:n))}catch(n){console.error(n)}};return e.jsx(D,{className:"pt-24 pb-16",children:e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Award Management"}),e.jsx("p",{className:"text-slate-600",children:"Manage recognition and nominations."})]}),e.jsxs("button",{onClick:()=>d(!0),className:"px-6 py-3 bg-tuio-red text-white rounded-xl font-bold uppercase tracking-wide flex items-center gap-2 hover:bg-tuio-navy transition-all shadow-lg",children:[e.jsx(G,{className:"w-5 h-5"})," New Award"]})]}),S&&e.jsx(w,{className:"mb-8 p-6 bg-white/50 border-tuio-red/30",children:e.jsxs("form",{onSubmit:A,className:"grid md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-gray-500 mb-1",children:"Award Title"}),e.jsx("input",{className:"w-full px-4 py-2 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-tuio-red",value:i.title,onChange:t=>m({...i,title:t.target.value}),placeholder:"e.g. Best Digital Dentist",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold uppercase text-gray-500 mb-1",children:"Year"}),e.jsx("input",{type:"number",className:"w-full px-4 py-2 rounded-lg border border-gray-200 outline-none focus:ring-2 focus:ring-tuio-red",value:i.year,onChange:t=>m({...i,year:parseInt(t.target.value)}),required:!0})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-tuio-navy text-white py-2 rounded-lg font-bold hover:bg-tuio-red transition-colors",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 bg-gray-200 rounded-lg font-bold text-gray-600",children:"Cancel"})]})]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1 space-y-4",children:u.map(t=>e.jsx("div",{onClick:()=>N(t),className:`p-6 rounded-2xl cursor-pointer transition-all border ${a?.id===t.id?"bg-white border-tuio-red shadow-lg scale-105":"bg-white/60 border-transparent hover:bg-white"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center text-yellow-600",children:e.jsx(j,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-tuio-navy",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wide mt-1",children:[e.jsx("span",{className:"text-gray-500",children:t.year}),e.jsx("span",{className:`px-2 py-0.5 rounded-full ${t.status==="closed"?"bg-red-100 text-red-600":"bg-green-100 text-green-600"}`,children:t.status?.replace("_"," ")})]})]})]})},t.id))}),e.jsx(w,{className:"lg:col-span-2 min-h-[500px]",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-start mb-6 pb-6 border-b border-gray-100",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-tuio-navy",children:[a.title," (",a.year,")"]}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Manage nominations and select winners."})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{value:_,onChange:t=>k(t.target.value),placeholder:"Nominate user...",className:"pl-10 pr-4 py-2 bg-gray-50 border border-gray-200 rounded-full text-sm outline-none focus:ring-2 focus:ring-tuio-red w-64"}),e.jsx(I,{className:"absolute left-3 top-2.5 w-4 h-4 text-gray-400"}),g.length>0&&e.jsx("div",{className:"absolute top-12 left-0 right-0 bg-white shadow-xl rounded-xl z-10 overflow-hidden border border-gray-100",children:g.map(t=>e.jsxs("div",{onClick:()=>U(t),className:"px-4 py-3 hover:bg-tuio-bg cursor-pointer text-sm font-medium text-tuio-navy",children:[t.full_name," ",e.jsx("span",{className:"text-xs text-gray-400 block",children:t.email})]},t.id))})]})]}),e.jsx("div",{className:"space-y-2",children:o.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 opacity-20"}),e.jsx("p",{children:"No nominations yet."})]}):o.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/50 rounded-xl hover:bg-white transition-colors border border-transparent hover:border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-tuio-bg rounded-full flex items-center justify-center font-bold text-tuio-navy",children:t.nominee_profile?.full_name?.[0]||"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-tuio-navy",children:t.nominee_profile?.full_name||"Unknown User"}),e.jsx("p",{className:"text-xs text-gray-500",children:t.nominee_profile?.email})]})]}),e.jsxs("select",{value:t.status,onChange:s=>E(t.id,s.target.value),className:`px-3 py-1.5 rounded-lg text-xs font-bold uppercase bg-transparent border border-gray-200 outline-none cursor-pointer ${t.status==="winner"?"text-yellow-600 bg-yellow-50 border-yellow-200":t.status==="shortlisted"?"text-red-600 bg-red-50":"text-gray-600"}`,children:[e.jsx("option",{value:"nominated",children:"Nominated"}),e.jsx("option",{value:"shortlisted",children:"Shortlisted"}),e.jsx("option",{value:"finalist",children:"Finalist"}),e.jsx("option",{value:"winner",children:"Winner"})]})]},t.id))})]}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-gray-400 opacity-60",children:[e.jsx(j,{className:"w-24 h-24 mb-4"}),e.jsx("p",{className:"text-xl font-tuio uppercase",children:"Select an Award"})]})})]})]})})}export{K as default};
