import{c as d}from"./supabase.svVmE_Zl.js";const u=d(),s=document.getElementById("new-thread-form"),t=s?.querySelector('button[type="submit"]');function f(n){return n.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")+"-"+Math.random().toString(36).substring(2,7)}s?.addEventListener("submit",async n=>{if(n.preventDefault(),!t)return;const i=t.textContent;t.textContent="Posting...",t.disabled=!0;const o=new FormData(s),a=o.get("title"),c=o.get("category"),r=o.get("content");if(!a||!c||!r){alert("Please fill in all fields"),t.textContent=i,t.disabled=!1;return}try{const{data:{user:e}}=await u.auth.getUser();if(!e)throw new Error("Not authenticated");const g=f(a),{error:l}=await u.from("threads").insert({title:a,slug:g,category:c,content:r,excerpt:r.substring(0,150)+(r.length>150?"...":""),author_id:e.id,created_at:new Date().toISOString()});if(l)throw l;window.location.href="/community"}catch(e){console.error(e),alert("Error posting discussion: "+e.message),t.textContent=i,t.disabled=!1}});
