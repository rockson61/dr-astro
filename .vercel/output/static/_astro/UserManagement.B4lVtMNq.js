import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.JXKNaeUN.js";import{c as q}from"./supabase.Chw8hJPJ.js";import{G as r}from"./GlassCard.Cfd5MXeQ.js";import{G as D}from"./GlassContainer.OVLJuRR9.js";import{U as I}from"./users.CLfLw16X.js";import{C as k}from"./circle-check-big.B_c9Grz5.js";import{c as O}from"./createLucideIcon.BhldaWgv.js";import{S as P}from"./search.BNTBrPA9.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],V=O("ban",H),d=q();function ae(){const[c,T]=l.useState(null),[f,L]=l.useState(null),[i,j]=l.useState([]),[R,N]=l.useState(!0),[v,B]=l.useState(""),[o,F]=l.useState("all"),[y,w]=l.useState(null),[G,h]=l.useState(!1),[p,_]=l.useState(""),[b,S]=l.useState(""),[C,U]=l.useState(!1),x=f==="admin"||f==="super_admin",g=f==="super_admin";l.useEffect(()=>{(async()=>{const{data:{user:t}}=await d.auth.getUser();if(t){T(t);const{data:n}=await d.from("profiles").select("role").eq("id",t.id).single();L(n?.role||"user")}else window.location.href="/login"})()},[]),l.useEffect(()=>{c&&(x||g)&&M()},[c,x,g]);const M=async()=>{try{N(!0);const{data:s,error:t}=await d.from("profiles").select("id, email, full_name, verification_status, account_status, role, created_at").order("created_at",{ascending:!1});if(t)throw t;if(!s||s.length===0){j([]);return}const n=s.map(a=>({id:a.id,email:a.email||"Email Hidden",full_name:a.full_name||null,is_banned:a.account_status==="suspended"||a.account_status==="banned",verified:a.verification_status==="verified",role:a.role||"user",created_at:a.created_at,verification_status:a.verification_status,account_status:a.account_status}));j(n)}catch(s){console.error("Error fetching users:",s),alert("Failed to load users")}finally{N(!1)}},z=async(s,t)=>{try{const n=t?"active":"suspended",{error:a}=await d.from("profiles").update({account_status:n}).eq("id",s);if(a)throw a;await E(s,t?"Account Restored":"Account Restricted",t?"Your account has been restored. You can now access all features.":"Your account has been restricted. Please contact support@dentalreach.co for more information.","general"),await M(),alert(`User ${t?"unbanned":"banned"} successfully!`)}catch(n){console.error("Error banning user:",n),alert("Failed to update user status")}},E=async(s,t,n,a="admin_message")=>{try{await d.from("notifications").insert({user_id:s,title:t,message:n,type:a,read:!1})}catch(u){console.error("Error sending notification:",u)}},Y=async()=>{if(!y||!p||!b){alert("Please fill in all fields");return}try{U(!0),await E(y.id,p,b,"general"),_(""),S(""),h(!1),w(null),alert("Message sent successfully!")}catch(s){console.error("Error sending message:",s),alert("Failed to send message")}finally{U(!1)}},$=i.filter(s=>{const t=v.toLowerCase(),n=s.full_name?.toLowerCase().includes(t),a=s.email.toLowerCase().includes(t),u=t===""||n||a,A=o==="all"||o==="active"&&!s.is_banned||o==="banned"&&s.is_banned;return u&&A}),m={total:i.length,active:i.filter(s=>!s.is_banned).length,banned:i.filter(s=>s.is_banned).length,verified:i.filter(s=>s.verified).length};if(!c||!x&&!g){if(R&&!c)return e.jsx("div",{className:"p-8 text-center",children:"Loading..."});if(c&&!x)return e.jsx("div",{className:"p-8 text-center text-red-500",children:"Access Denied"})}return e.jsx(D,{className:"pt-24 pb-16",children:e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"User Management"}),e.jsx("p",{className:"text-slate-600",children:"Manage users, ban accounts, and send messages"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[e.jsx(r,{hoverEffect:!0,className:"p-6",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:m.total})]}),e.jsx(I,{className:"text-blue-600"})]})}),e.jsx(r,{hoverEffect:!0,className:"p-6",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.active})]}),e.jsx(k,{className:"text-green-600"})]})}),e.jsx(r,{hoverEffect:!0,className:"p-6",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Banned"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.banned})]}),e.jsx(V,{className:"text-red-600"})]})}),e.jsx(r,{hoverEffect:!0,className:"p-6",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Verified"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.verified})]}),e.jsx(k,{className:"text-red-600"})]})})]}),e.jsx(r,{className:"p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(P,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:v,onChange:s=>B(s.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg"})]}),e.jsxs("select",{value:o,onChange:s=>F(s.target.value),className:"px-4 py-2 border rounded-lg",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"banned",children:"Banned Only"})]})]})}),e.jsx(r,{className:"!p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50/50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"User"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"Role"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:$.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3 text-blue-600 font-bold",children:s.email[0].toUpperCase()}),e.jsx("div",{className:"text-sm font-medium",children:s.full_name||s.email})]})}),e.jsx("td",{className:"px-6 py-4 capitalize text-sm",children:s.role}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-bold ${s.is_banned?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:s.is_banned?"Banned":"Active"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>z(s.id,s.is_banned),className:`px-3 py-1 rounded text-sm font-medium ${s.is_banned?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:s.is_banned?"Unban":"Ban"}),e.jsx("button",{onClick:()=>{w(s),h(!0)},className:"px-3 py-1 rounded text-sm font-medium bg-blue-100 text-blue-700",children:"Message"})]})})]},s.id))})]})})}),G&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[100]",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full m-4",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Send Message"}),e.jsx("input",{className:"w-full mb-3 p-2 border rounded",placeholder:"Title",value:p,onChange:s=>_(s.target.value)}),e.jsx("textarea",{className:"w-full mb-4 p-2 border rounded",placeholder:"Message content...",rows:4,value:b,onChange:s=>S(s.target.value)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded",children:"Cancel"}),e.jsx("button",{onClick:Y,disabled:C,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:C?"Sending...":"Send"})]})]})})]})})}export{ae as default};
