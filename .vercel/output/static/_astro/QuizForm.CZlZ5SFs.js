import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.JXKNaeUN.js";import{c as w}from"./supabase.Chw8hJPJ.js";import{G as N}from"./GlassCard.Cfd5MXeQ.js";import{T as C}from"./trash-2.Fj75jIkq.js";import{P as q}from"./plus.x7Bu--mN.js";import{L as z}from"./loader-circle.ofVaKFwt.js";import{S as Q}from"./save.0XUVOi49.js";import"./createLucideIcon.BhldaWgv.js";const c=w();function T(){const[u,p]=l.useState(!1),[m,g]=l.useState([]),[b,h]=l.useState([]),[s,o]=l.useState({title:"",article_id:"",case_id:"",ce_credits:1,passing_score:70,questions:[{question_text:"",options:["","","",""],correct_option:0}]});l.useEffect(()=>{f()},[]);const f=async()=>{const{data:t}=await c.from("articles").select("id, title"),{data:r}=await c.from("clinical_cases").select("id, title");t&&g(t),r&&h(r)},x=(t,r,i)=>{const a=[...s.questions];a[t][r]=i,o({...s,questions:a})},y=(t,r,i)=>{const a=[...s.questions];a[t].options[r]=i,o({...s,questions:a})},j=()=>{o({...s,questions:[...s.questions,{question_text:"",options:["","","",""],correct_option:0}]})},v=t=>{const r=[...s.questions];r.splice(t,1),o({...s,questions:r})},_=async t=>{t.preventDefault(),p(!0);try{const{data:r,error:i}=await c.from("quizzes").insert({title:s.title,article_id:s.article_id||null,case_id:s.case_id||null,ce_credits:s.ce_credits,passing_score:s.passing_score}).select().single();if(i)throw i;const a=s.questions.map(d=>({quiz_id:r.id,question_text:d.question_text,options:d.options,correct_option:parseInt(d.correct_option),explanation:""})),{error:n}=await c.from("quiz_questions").insert(a);if(n)throw n;alert("Quiz created successfully!"),window.location.href="/dashboard/admin"}catch(r){console.error(r),alert("Error creating quiz: "+r.message)}finally{p(!1)}};return e.jsxs(N,{className:"max-w-4xl mx-auto p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-tuio-navy mb-6",children:"Create CE Quiz"}),e.jsxs("form",{onSubmit:_,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white/50 p-6 rounded-2xl border border-gray-100 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Quiz Title"}),e.jsx("input",{type:"text",required:!0,value:s.title,onChange:t=>o({...s,title:t.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-200",placeholder:"e.g. Endodontics Case Review Quiz"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Link Article (Optional)"}),e.jsxs("select",{value:s.article_id,onChange:t=>o({...s,article_id:t.target.value,case_id:""}),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white",children:[e.jsx("option",{value:"",children:"Select Article..."}),m.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Link Case (Optional)"}),e.jsxs("select",{value:s.case_id,onChange:t=>o({...s,case_id:t.target.value,article_id:""}),className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white",children:[e.jsx("option",{value:"",children:"Select Case..."}),b.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"CE Credits"}),e.jsx("input",{type:"number",step:"0.5",value:s.ce_credits,onChange:t=>o({...s,ce_credits:parseFloat(t.target.value)}),className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Passing Score (%)"}),e.jsx("input",{type:"number",value:s.passing_score,onChange:t=>o({...s,passing_score:parseInt(t.target.value)}),className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[s.questions.map((t,r)=>e.jsxs("div",{className:"bg-white p-6 rounded-2xl border border-gray-200 relative",children:[e.jsx("button",{type:"button",onClick:()=>v(r),className:"absolute top-4 right-4 text-red-400 hover:text-red-600",children:e.jsx(C,{size:18})}),e.jsxs("h4",{className:"font-bold text-gray-400 uppercase text-xs tracking-widest mb-4",children:["Question ",r+1]}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",required:!0,value:t.question_text,onChange:i=>x(r,"question_text",i.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200",placeholder:"Enter question text..."})}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:t.options.map((i,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:`correct-${r}`,checked:t.correct_option===a,onChange:()=>x(r,"correct_option",a),className:"w-4 h-4 text-tuio-red focus:ring-tuio-red"}),e.jsx("input",{type:"text",required:!0,value:i,onChange:n=>y(r,a,n.target.value),className:`w-full px-3 py-2 rounded-lg border ${t.correct_option===a?"border-green-500 bg-green-50":"border-gray-200"}`,placeholder:`Option ${String.fromCharCode(65+a)}`})]},a))})]},r)),e.jsxs("button",{type:"button",onClick:j,className:"w-full py-4 border-2 border-dashed border-gray-300 rounded-2xl text-gray-500 font-bold hover:border-tuio-navy hover:text-tuio-navy transition-all flex items-center justify-center gap-2",children:[e.jsx(q,{size:20})," Add Question"]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:u,className:"px-8 py-4 bg-tuio-navy text-white rounded-xl font-bold uppercase tracking-wide hover:bg-tuio-red transition-all flex items-center gap-2",children:[u?e.jsx(z,{className:"animate-spin"}):e.jsx(Q,{size:20}),"Save Quiz"]})})]})]})}export{T as default};
