import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as b}from"./index.JXKNaeUN.js";import{c as N}from"./supabase.C4yJ2ZhP.js";import{G as _}from"./GlassCard.Cfd5MXeQ.js";import{c as v}from"./createLucideIcon.BhldaWgv.js";import{P as u}from"./plus.x7Bu--mN.js";import{T as h}from"./trash-2.Fj75jIkq.js";import{L as w}from"./loader-circle.ofVaKFwt.js";import{S as C}from"./save.0XUVOi49.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],S=v("activity",k),c=N();function O({initialData:r}){const[m,x]=b.useState(!1),[s,n]=b.useState({title:r?.title||"",patient_age:r?.patient_age||"",gender:r?.gender||"Male",chief_complaint:r?.chief_complaint||"",medical_history:r?.medical_history||"",diagnosis:r?.diagnosis||"",treatment_plan:r?.treatment_plan||"",procedure_details:r?.procedure_details||"",conclusion:r?.conclusion||"",pre_op_images:r?.pre_op_images||[],post_op_images:r?.post_op_images||[]}),o=t=>{n({...s,[t.target.name]:t.target.value})},p=t=>{const a=prompt("Enter Image URL:");a&&n({...s,[t]:[...s[t],a]})},g=(t,a)=>{const l=[...s[t]];l.splice(a,1),n({...s,[t]:l})},y=t=>t.toLowerCase().replace(/[^a-z0-9]+/g,"-")+"-"+Math.random().toString(36).substring(2,7),f=async t=>{t.preventDefault(),x(!0);try{const{data:{user:a}}=await c.auth.getUser();if(!a)throw new Error("Not authenticated");const l={...s,patient_age:parseInt(s.patient_age)||0,updated_at:new Date().toISOString()};let d;if(r?.id){const{error:i}=await c.from("clinical_cases").update(l).eq("id",r.id);d=i}else{const i=y(s.title),{error:j}=await c.from("clinical_cases").insert({...l,slug:i,author_id:a.id,status:"draft"});d=j}if(d)throw d;window.location.href="/dashboard/my-articles"}catch(a){alert(a.message)}finally{x(!1)}};return e.jsxs(_,{className:"max-w-4xl mx-auto p-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-tuio-navy mb-6 flex items-center gap-2",children:[e.jsx(S,{className:"text-tuio-red"}),r?"Edit Clinical Case":"Submit New Case Study"]}),e.jsxs("form",{onSubmit:f,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-gray-400 uppercase text-xs tracking-widest border-b pb-2",children:"Case Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Case Title"}),e.jsx("input",{type:"text",name:"title",required:!0,value:s.title,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200",placeholder:"e.g. Full Mouth Rehabilitation of a 60-year-old Patient"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-gray-400 uppercase text-xs tracking-widest border-b pb-2",children:"Patient Details (Anonymized)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Age"}),e.jsx("input",{type:"number",name:"patient_age",value:s.patient_age,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Gender"}),e.jsxs("select",{name:"gender",value:s.gender,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-white",children:[e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Chief Complaint"}),e.jsx("textarea",{name:"chief_complaint",rows:2,value:s.chief_complaint,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Medical History"}),e.jsx("textarea",{name:"medical_history",rows:2,value:s.medical_history,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-gray-400 uppercase text-xs tracking-widest border-b pb-2",children:"Clinical Workflow"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Diagnosis"}),e.jsx("textarea",{name:"diagnosis",rows:3,value:s.diagnosis,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Treatment Plan"}),e.jsx("textarea",{name:"treatment_plan",rows:3,value:s.treatment_plan,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Procedure Details"}),e.jsx("textarea",{name:"procedure_details",rows:5,value:s.procedure_details,onChange:o,className:"w-full px-4 py-3 rounded-xl border border-gray-200 bg-gray-50 font-mono text-sm",placeholder:"Detailed step-by-step description..."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-bold text-gray-400 uppercase text-xs tracking-widest border-b pb-2",children:"Clinical Images"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Pre-Op Images"}),e.jsxs("button",{type:"button",onClick:()=>p("pre_op_images"),className:"text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx(u,{size:12})," Add URL"]})]}),e.jsxs("div",{className:"space-y-2",children:[s.pre_op_images.map((t,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,className:"w-full h-32 object-cover rounded-lg border border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>g("pre_op_images",a),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h,{size:12})})]},a)),s.pre_op_images.length===0&&e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg text-gray-400 text-sm",children:"No images added"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"Post-Op Images"}),e.jsxs("button",{type:"button",onClick:()=>p("post_op_images"),className:"text-xs bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx(u,{size:12})," Add URL"]})]}),e.jsxs("div",{className:"space-y-2",children:[s.post_op_images.map((t,a)=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t,className:"w-full h-32 object-cover rounded-lg border border-gray-200"}),e.jsx("button",{type:"button",onClick:()=>g("post_op_images",a),className:"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h,{size:12})})]},a)),s.post_op_images.length===0&&e.jsx("div",{className:"text-center py-8 bg-gray-50 rounded-lg text-gray-400 text-sm",children:"No images added"})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-6 border-t border-gray-100",children:e.jsxs("button",{type:"submit",disabled:m,className:"px-8 py-4 bg-tuio-red text-white rounded-xl font-bold uppercase tracking-wide hover:bg-tuio-navy transition-all flex items-center gap-2",children:[m?e.jsx(w,{className:"animate-spin"}):e.jsx(C,{className:"w-5 h-5"}),"Save Case Study"]})})]})]})}export{O as default};
