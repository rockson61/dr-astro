import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.JXKNaeUN.js";import{c as b}from"./supabase.C4yJ2ZhP.js";import{c as y}from"./createLucideIcon.BhldaWgv.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],j=y("bell",v),i=b();function C(){const[o,d]=r.useState(0),[n,m]=r.useState(!1),[c,l]=r.useState([]),[h,x]=r.useState(!1);r.useEffect(()=>{u();const e=setInterval(u,3e4);return()=>clearInterval(e)},[]);const u=async()=>{const{data:{user:e}}=await i.auth.getUser();if(!e)return;const{count:a,error:s}=await i.from("notifications").select("*",{count:"exact",head:!0}).eq("user_id",e.id).eq("is_read",!1);!s&&a!==null&&d(a)},f=async()=>{x(!0);const{data:{user:e}}=await i.auth.getUser();if(e){const{data:a}=await i.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(5);l(a||[])}x(!1)},g=()=>{n||f(),m(!n)},p=async(e,a)=>{await i.from("notifications").update({is_read:!0}).eq("id",e),d(s=>Math.max(0,s-1)),l(c.map(s=>s.id===e?{...s,is_read:!0}:s)),a&&(window.location.href=a)};return t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:g,className:"relative p-2 rounded-full hover:bg-gray-100 transition-colors text-gray-600",children:[t.jsx(j,{size:20}),o>0&&t.jsx("span",{className:"absolute top-0 right-0 inline-flex items-center justify-center w-4 h-4 text-[10px] font-bold text-white bg-red-500 rounded-full border-2 border-white",children:o>9?"9+":o})]}),n&&t.jsxs("div",{className:"absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-xl border border-gray-100 py-2 z-50 animate-in fade-in zoom-in duration-200",children:[t.jsxs("div",{className:"px-4 py-2 border-b border-gray-50 flex justify-between items-center",children:[t.jsx("h3",{className:"font-bold text-tuio-navy text-sm",children:"Notifications"}),t.jsx("a",{href:"/dashboard/notifications",className:"text-xs text-tuio-red font-bold hover:underline",children:"View All"})]}),h?t.jsx("div",{className:"p-8 text-center text-gray-400 text-xs",children:"Loading..."}):c.length>0?t.jsx("div",{className:"max-h-80 overflow-y-auto",children:c.map(e=>t.jsx("div",{onClick:()=>p(e.id,e.link),className:`px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors border-b border-gray-50 last:border-0 ${e.is_read?"":"bg-blue-50/50"}`,children:t.jsxs("div",{className:"flex gap-3",children:[t.jsx("div",{className:`mt-1 w-2 h-2 rounded-full shrink-0 ${e.is_read?"bg-gray-200":"bg-tuio-red"}`}),t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-gray-800 leading-tight mb-1",children:e.title}),t.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:e.message}),t.jsx("p",{className:"text-[10px] text-gray-400 mt-1 uppercase tracking-wide",children:new Date(e.created_at).toLocaleDateString()})]})]})},e.id))}):t.jsx("div",{className:"p-8 text-center text-gray-400 text-sm",children:"No notifications yet."})]})]})}export{C as default};
