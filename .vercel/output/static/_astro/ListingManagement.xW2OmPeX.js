import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.JXKNaeUN.js";import{c as _}from"./supabase.Chw8hJPJ.js";import{G as n}from"./GlassCard.Cfd5MXeQ.js";import{G as L}from"./GlassContainer.OVLJuRR9.js";import{P as C}from"./plus.x7Bu--mN.js";import{B as k}from"./building-2.DyrblHIy.js";import{c as S}from"./createLucideIcon.BhldaWgv.js";import{C as V}from"./circle-check-big.B_c9Grz5.js";import{S as E}from"./search.BNTBrPA9.js";import{E as T,C as A}from"./external-link.C_b5xoWq.js";import{T as B}from"./trash-2.Fj75jIkq.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],h=S("shield-check",D),m=_();function H(){const[a,d]=l.useState([]),[j,g]=l.useState(!0),[x,y]=l.useState(""),[c,b]=l.useState("all"),[p,o]=l.useState(!1);l.useEffect(()=>{v()},[]);const v=async()=>{try{g(!0);const{data:s,error:t}=await m.from("listings").select(`
                    id, 
                    business_name, 
                    slug, 
                    is_verified, 
                    created_at,
                    profiles!owner_id (full_name, email)
                `).order("created_at",{ascending:!1});if(t)throw t;if(s){const r=s.map(i=>({id:i.id,business_name:i.business_name,slug:i.slug,is_verified:i.is_verified,created_at:i.created_at,owner:i.profiles}));d(r)}}catch(s){console.error("Error fetching listings:",s),alert("Failed to load listings")}finally{g(!1)}},N=async(s,t)=>{if(confirm(`Are you sure you want to ${t?"remove verification from":"verify"} this listing?`))try{o(!0);const{error:r}=await m.from("listings").update({is_verified:!t}).eq("id",s);if(r)throw r;d(a.map(i=>i.id===s?{...i,is_verified:!t}:i))}catch(r){console.error("Error updating verification:",r),alert("Failed to update status")}finally{o(!1)}},w=async s=>{if(confirm("Are you sure you want to delete this listing? This cannot be undone."))try{o(!0);const{error:t}=await m.from("listings").delete().eq("id",s);if(t)throw t;d(a.filter(r=>r.id!==s))}catch(t){console.error("Error deleting listing:",t),alert("Failed to delete listing")}finally{o(!1)}},u=a.filter(s=>{const t=s.business_name.toLowerCase().includes(x.toLowerCase())||s.owner?.full_name?.toLowerCase().includes(x.toLowerCase()),r=c==="all"||c==="verified"&&s.is_verified||c==="unverified"&&!s.is_verified;return t&&r}),f={total:a.length,verified:a.filter(s=>s.is_verified).length,unverified:a.filter(s=>!s.is_verified).length};return j?e.jsx("div",{className:"p-12 text-center text-gray-500",children:"Loading listings..."}):e.jsx(L,{className:"pt-24 pb-16",children:e.jsxs("div",{className:"max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Listing Management"}),e.jsx("p",{className:"text-slate-600",children:"Verify and manage business directory listings."})]}),e.jsxs("a",{href:"/dashboard/listings/new",className:"px-6 py-3 bg-tuio-red text-white rounded-xl font-bold uppercase tracking-wide hover:bg-tuio-navy transition-all shadow-lg flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"Add Listing"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(n,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold uppercase",children:"Total Listings"}),e.jsx("p",{className:"text-3xl font-bold text-slate-800",children:f.total})]}),e.jsx(k,{className:"w-10 h-10 text-blue-500 opacity-20"})]}),e.jsxs(n,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 font-bold uppercase",children:"Verified"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:f.verified})]}),e.jsx(h,{className:"w-10 h-10 text-green-500 opacity-20"})]}),e.jsxs(n,{className:"p-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 font-bold uppercase",children:"Unverified"}),e.jsx("p",{className:"text-3xl font-bold text-gray-500",children:f.unverified})]}),e.jsx(V,{className:"w-10 h-10 text-gray-300 opacity-20"})]})]}),e.jsx(n,{className:"p-6 mb-8",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-grow max-w-lg",children:[e.jsx(E,{className:"absolute left-3 top-3 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by business name or owner...",value:x,onChange:s=>y(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("select",{value:c,onChange:s=>b(s.target.value),className:"px-4 py-2 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Listings"}),e.jsx("option",{value:"verified",children:"Verified Only"}),e.jsx("option",{value:"unverified",children:"Unverified Only"})]})]})}),e.jsx(n,{className:"!p-0 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase",children:"Business Name"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase",children:"Owner"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase",children:"Verification"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-gray-500 uppercase",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[u.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-bold text-slate-800",children:s.business_name}),s.is_verified&&e.jsx(h,{className:"w-4 h-4 text-green-500"})]}),e.jsxs("a",{href:`/directory/${s.slug}`,target:"_blank",className:"text-xs text-blue-500 hover:underline flex items-center gap-1 mt-1",children:["View Listing ",e.jsx(T,{className:"w-3 h-3"})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs font-bold text-slate-600",children:s.owner?.full_name?.[0]||"?"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-slate-900",children:s.owner?.full_name||"Unknown"}),e.jsx("p",{className:"text-xs text-gray-500",children:s.owner?.email})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide ${s.is_verified?"bg-green-100 text-green-700":"bg-gray-100 text-gray-500"}`,children:s.is_verified?"Verified":"Unverified"})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>N(s.id,s.is_verified),disabled:p,className:`p-2 rounded-lg transition-colors ${s.is_verified?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-green-50 text-green-600 hover:bg-green-100"}`,title:s.is_verified?"Revoke Verification":"Verify Listing",children:s.is_verified?e.jsx(A,{className:"w-5 h-5"}):e.jsx(h,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>w(s.id),disabled:p,className:"p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors title='Delete'",children:e.jsx(B,{className:"w-5 h-5"})})]})})]},s.id)),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500",children:"No listings found."})})]})]})})})]})})}export{H as default};
