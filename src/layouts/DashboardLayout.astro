---
import '../styles/global.css';

interface Props {
	title: string;
}

const { title } = Astro.props;
const currentPath = Astro.url.pathname;

const sidebarLinks = [
    { section: 'Overview', items: [
        { label: 'Dashboard', href: '/dashboard', icon: 'üìä' },
    ]},
    { section: 'My Content', items: [
        { label: 'My Articles', href: '/dashboard/my-articles', icon: 'üìù' },
        { label: 'My Listings', href: '/dashboard/my-listings', icon: 'üè¢' },
        { label: 'My Awards', href: '/dashboard/my-awards', icon: 'üèÜ' },
    ]},
    { section: 'Create', items: [
        { label: 'New Article', href: '/dashboard/articles/new', icon: '‚úçÔ∏è' },
        { label: 'New Listing', href: '/dashboard/listings/new', icon: '‚ûï' },
    ]},
    { section: 'Account', items: [
        { label: 'Settings', href: '/dashboard/settings', icon: '‚öôÔ∏è' },
    ]},
];
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/png" href="/images/logo-mini.png" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Paytone+One&display=swap" rel="stylesheet">
		<title>{title} | DR Dashboard</title>
	</head>
	<body class="bg-tuio-bg flex h-screen overflow-hidden text-gray-800">
		
        <!-- Sidebar -->
        <aside class="w-72 bg-tuio-navy flex-shrink-0 flex flex-col hidden md:flex">
            <!-- Logo -->
            <div class="h-20 flex items-center px-6 border-b border-white/10">
                <a href="/" class="flex items-center gap-3 group">
                    <div class="w-10 h-10 bg-tuio-pink rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                        <span class="text-white font-tuio text-xl">D</span>
                    </div>
                    <span class="font-tuio text-xl uppercase text-white">Dashboard</span>
                </a>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-grow p-6 space-y-6 overflow-y-auto">
                {sidebarLinks.map(section => (
                    <div>
                        <div class="text-xs font-bold text-tuio-pink uppercase tracking-widest mb-3 px-3">{section.section}</div>
                        <div class="space-y-1">
                            {section.items.map(item => (
                                <a 
                                    href={item.href} 
                                    class={`flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all ${
                                        currentPath === item.href 
                                            ? 'bg-tuio-pink text-white' 
                                            : 'text-white/70 hover:bg-white/10 hover:text-white'
                                    }`}
                                >
                                    <span class="text-lg">{item.icon}</span>
                                    {item.label}
                                </a>
                            ))}
                        </div>
                    </div>
                ))}
            </nav>
            
            <!-- Footer -->
            <div class="p-6 border-t border-white/10">
                <a href="/" class="flex items-center gap-2 text-white/50 hover:text-white transition-colors text-sm mb-4">
                    ‚Üê Back to Site
                </a>
                <button id="logout-btn" class="flex items-center gap-2 text-red-400 hover:text-red-300 text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                    Sign Out
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-grow flex flex-col h-full overflow-hidden">
            <!-- Header -->
            <header class="h-20 bg-white border-b border-gray-100 flex items-center justify-between px-8 shadow-sm">
                <div class="flex items-center gap-4">
                    <!-- Mobile Menu -->
                    <button class="md:hidden w-10 h-10 bg-tuio-bg rounded-xl flex items-center justify-center">
                        ‚ò∞
                    </button>
                    <h1 class="text-2xl font-tuio uppercase text-tuio-navy">{title}</h1>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Notifications -->
                    <button class="w-10 h-10 bg-tuio-bg rounded-xl flex items-center justify-center text-tuio-navy hover:bg-tuio-pink hover:text-white transition-colors relative">
                        üîî
                        <span class="absolute -top-1 -right-1 w-4 h-4 bg-tuio-pink rounded-full text-white text-xs flex items-center justify-center">3</span>
                    </button>
                    <!-- Profile -->
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-tuio-pink text-white flex items-center justify-center font-tuio">
                            DR
                        </div>
                        <div class="hidden sm:block">
                            <div class="font-bold text-tuio-navy text-sm">Dr. User</div>
                            <div class="text-xs text-gray-400">Dentist</div>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Content Area -->
            <div class="flex-grow overflow-y-auto p-8">
                <slot />
            </div>
        </main>

	</body>
</html>

<script>
    import { createSupabaseBrowserClient } from '../lib/supabase';
    const supabase = createSupabaseBrowserClient();
    
    document.getElementById('logout-btn')?.addEventListener('click', async () => {
        await supabase.auth.signOut();
        window.location.href = '/login';
    });
</script>
