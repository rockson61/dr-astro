---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { supabase } from "../../lib/supabase";

export const prerender = false;

const { slug } = Astro.params;

// Fetch product
const { data: product } = await supabase
    .from("products")
    .select("*")
    .eq("slug", slug)
    .single();

// Mock fallback
const mockProduct = {
    title: "Dental Chair X3000",
    category: "Equipment",
    price: "$4,500",
    rating: "4.8",
    description: `Experience the future of dental ergonomics with the X3000. Designed for maximum patient comfort and practitioner efficiency, this chair features intuitive controls, memory foam cushioning, and integrated LED lighting.

  **Key Features:**
  - Ultra-silent hydraulic lift
  - 3-axis adaptable headrest
  - Integrated intraoral camera mount
  - Easy-clean seamless upholstery
  - 5-year warranty`,
    features: [
        "Ergonomic Design",
        "Silent Operation",
        "LED Lighting",
        "Memory Foam",
        "Smart Controls",
    ],
    image_url:
        "https://images.pexels.com/photos/3845625/pexels-photo-3845625.jpeg?auto=compress&cs=tinysrgb&w=800",
    seller: "Apex Dental Supplies",
    seller_rating: "4.9",
    specs: {
        Weight: "150kg",
        Power: "110V/220V",
        Colors: "Blue, Green, White",
        Dimensions: "180x60x120cm",
    },
};

const displayProduct = product || mockProduct;
---

<BaseLayout title={`${displayProduct.title} | DentalReach Marketplace`}>
    <div class="bg-gray-50 py-12">
        <div class="container mx-auto px-4 max-w-6xl">
            <!-- Breadcrumb -->
            <div class="mb-6 text-sm text-gray-500">
                <a href="/" class="hover:text-tuio-red">Home</a> &gt;
                <a href="/products" class="hover:text-tuio-red">Marketplace</a> &gt;
                <span class="text-tuio-navy font-bold"
                    >{displayProduct.title}</span
                >
            </div>

            <div
                class="grid md:grid-cols-2 gap-12 bg-white rounded-[32px] p-8 shadow-sm"
            >
                <!-- Image Gallery -->
                <div class="space-y-4">
                    <div
                        class="aspect-square bg-gray-100 rounded-2xl overflow-hidden border border-gray-200 p-8 flex items-center justify-center relative group"
                    >
                        <img
                            src={displayProduct.image_url ||
                                "/images/pattern.png"}
                            alt={displayProduct.title}
                            class="max-w-full max-h-full object-contain mix-blend-multiply group-hover:scale-110 transition-transform duration-500"
                        />
                        <div
                            class="absolute top-4 left-4 bg-tuio-red text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider"
                        >
                            {displayProduct.category}
                        </div>
                    </div>
                </div>

                <!-- Product Info -->
                <div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2 text-yellow-500">
                            {
                                "â˜…".repeat(
                                    Math.round(
                                        Number(displayProduct.rating || 0),
                                    ),
                                )
                            }
                            <span class="text-gray-400 text-sm"
                                >({displayProduct.rating})</span
                            >
                        </div>
                        <span
                            class="text-green-600 bg-green-50 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider"
                            >In Stock</span
                        >
                    </div>

                    <h1 class="font-tuio text-4xl text-tuio-navy mb-4">
                        {displayProduct.title}
                    </h1>
                    <div class="text-3xl font-bold text-tuio-red mb-6">
                        {displayProduct.price}
                    </div>

                    <div
                        class="prose prose-sm text-gray-600 mb-8"
                        set:html={displayProduct.description?.replace(
                            /\n/g,
                            "<br/>",
                        )}
                    />

                    <div
                        class="flex gap-4 mb-8 border-t border-b border-gray-100 py-6"
                    >
                        <div class="flex-1">
                            <button
                                class="w-full py-4 bg-tuio-navy text-white rounded-full font-bold uppercase tracking-wide hover:bg-tuio-red transition-all"
                            >
                                Add to Cart
                            </button>
                        </div>
                        <div class="flex-1">
                            <button
                                class="w-full py-4 border-2 border-tuio-navy text-tuio-navy rounded-full font-bold uppercase tracking-wide hover:bg-gray-50 transition-all"
                            >
                                Contact Seller
                            </button>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-bold text-tuio-navy mb-3">
                            Specifications
                        </h3>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            {
                                displayProduct.specs &&
                                    Object.entries(displayProduct.specs).map(
                                        ([key, value]) => (
                                            <div class="flex justify-between border-b border-gray-100 pb-2">
                                                <span class="text-gray-500">
                                                    {key}
                                                </span>
                                                <span class="font-bold text-gray-900">
                                                    {String(value)}
                                                </span>
                                            </div>
                                        ),
                                    )
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</BaseLayout>
